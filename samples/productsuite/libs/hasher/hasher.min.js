/*!
 * Hasher <http://github.com/millermedeiros/hasher>
 * @author Miller Medeiros
 * @version 1.1.0 (2011/11/01 07:15 PM)
 * Released under the MIT License
 */

(function(e){e("hasher",["signals"],function(e){var t=function(t){function E(e){if(!e)return"";var t=new RegExp("^\\"+u.prependHash+"|\\"+u.appendHash+"$","g");return e.replace(t,"")}function S(){var e=p.exec(u.getURL());return e&&e[1]?decodeURIComponent(e[1]):""}function x(){return c?c.contentWindow.frameHash:null}function T(){c=r.createElement("iframe"),c.src="about:blank",c.style.display="none",r.body.appendChild(c)}function N(){if(c&&a!==x()){var e=c.contentWindow.document;e.open(),e.write("<html><head><title>"+r.title+'</title><script type="text/javascript">var frameHash="'+a+'";</script></head><body>&nbsp;</body></html>'),e.close()}}function C(e,t){e=decodeURIComponent(e);if(a!==e){var n=a;a=e,y&&(t?c.contentWindow.frameHash=e:N()),u.changed.dispatch(E(e),E(n))}}function k(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function L(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)}function A(e){e=Array.prototype.slice.call(arguments);var t=e.join(u.separator);return t=t?u.prependHash+t.replace(v,"")+u.appendHash:t,m&&w&&(t=t.replace(/\?/,"%3F")),t}var n=25,r=t.document,i=t.location,s=t.history,o=e.Signal,u,a,f,l,c,h,p=/#(.*)$/,d=/(\?.*)|(\#.*)/,v=/^\#/,m=!1,g="onhashchange"in t,y=m&&!g,w=i.protocol==="file:";return y?h=function(){var e=S(),t=x();t!==a&&t!==e?u.setHash(E(t)):e!==a&&C(e)}:h=function(){var e=S();e!==a&&C(e)},u={VERSION:"1.1.0",appendHash:"",prependHash:"/",separator:"/",changed:new o,stopped:new o,initialized:new o,init:function(){if(l)return;a=S(),g?k(t,"hashchange",h):(y&&(c||T(),N()),f=setInterval(h,n)),l=!0,u.initialized.dispatch(E(a))},stop:function(){if(!l)return;g?L(t,"hashchange",h):(clearInterval(f),f=null),l=!1,u.stopped.dispatch(E(a))},isActive:function(){return l},getURL:function(){return i.href},getBaseURL:function(){return u.getURL().replace(d,"")},setHash:function(e){e=A.apply(null,arguments),e!==a&&(C(e),i.hash="#"+encodeURI(e))},replaceHash:function(e){e=A.apply(null,arguments),e!==a&&(C(e,!0),i.replace("#"+encodeURI(e)))},getHash:function(){return E(a)},getHashAsArray:function(){return u.getHash().split(u.separator)},dispose:function(){u.stop(),u.initialized.dispose(),u.stopped.dispose(),u.changed.dispose(),c=u=t.hasher=null},toString:function(){return'[hasher version="'+u.VERSION+'" hash="'+u.getHash()+'"]'}},u.initialized.memorize=!0,u}(window);return t})})(typeof define=="function"&&define.amd?define:function(e,t,n){window[e]=n(window[t[0]])})